<!DOCTYPE html><html lang="en">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>Creature of Habit - Joel Strouts</title>

<meta name="description" content="A brief update. An important work milestone and a vignette of how I spend my wild late nights in this vibrant, restless city - working in McDonalds.">
<link rel="canonical" href="https://joelstrouts.com/2019/07/20/In-McDonalds-Again.html"><link rel="alternate" type="application/rss+xml" title="Joel Strouts" href="/feed.xml"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png?v1.1=LbyJdBL709">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png?v1.1=LbyJdBL709">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png?v1.1=LbyJdBL709">
<link rel="manifest" href="/assets/site.webmanifest?v1.1=LbyJdBL709">
<link rel="mask-icon" href="/assets/safari-pinned-tab.svg?v1.1=LbyJdBL709" color="#3237c7">
<link rel="shortcut icon" href="/assets/favicon.ico?v1.1=LbyJdBL709">
<meta name="msapplication-TileColor" content="#2b5797">
<meta name="msapplication-config" content="/assets/browserconfig.xml?v1.1=LbyJdBL709">
<meta name="theme-color" content="#2b5797">

<link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" ><!-- start custom head snippets -->

<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.4',
      sources: {
        font_awesome: 'https://use.fontawesome.com/releases/v5.0.13/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script></head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root"><div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 800 800" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(1.21274,0,0,1.21274,-75.7331,-93.4479)">
        <path d="M562.395,295.627C560.512,297.025 551.242,322.774 551.162,324.287C550.731,332.429 554.595,376.434 554.31,376.49C504.401,386.25 433.863,370.182 428.223,368.608C425.472,367.841 421.343,328.303 421.343,327.585C421.343,300.939 451.363,257.227 454.015,254.586C455.824,252.783 523.202,252.674 540.831,242.653C566.401,228.118 584.997,216.537 584.752,213.213C580.554,156.171 576.428,158.554 572.543,160.746C558.803,168.5 518.566,191.722 504.374,192.927C470.037,195.845 402.849,187.281 345.468,170.318L345.42,170.206C302.039,211.417 261.028,265.322 246.386,296.517C240.335,309.411 240.326,355.868 240.171,371.644C240.128,376.105 240.128,380.869 188.629,355.985C185.628,354.534 184.897,332.639 185.094,303.227C185.229,282.95 218.824,224.544 218.168,222.076C217.206,218.459 194.361,170.605 171.285,157.282C170.663,156.923 134.358,140.73 132.317,142.728C128.134,146.826 78.95,199.88 62.448,247.982C62.354,248.257 102.395,266.913 109.232,271.357C110.502,272.183 128.166,293.086 128.435,295.415L128.75,295.545C124.41,330.321 92.164,381.391 103.598,392.678C150.283,438.764 174.943,446.333 206.608,477.997C214.523,485.912 159.36,559.11 159.36,559.11C159.36,559.11 129.186,546.323 128.891,546.141L128.509,546.036C128.204,546.201 102.043,565.938 102.043,565.938C102.043,565.938 137.853,650.31 148.665,647.413C191.92,635.823 210.804,618.251 274.058,600.863C289.55,596.604 317.655,650.066 345.601,671.212L345.61,671.215C408.646,579.615 438.911,512.775 439.792,508.038C441.131,498.74 438.527,444.74 437.665,433.264C455.966,435.467 511.966,440.992 551.541,442.306C555.424,479.527 562.321,545.792 562.321,545.792L562.33,545.778C562.33,545.778 623.166,572.938 657.342,588.185C678.267,554.57 711.052,508.834 722.11,494.087C711.741,489.095 663.673,464.35 656.29,458.542C652.628,455.41 609.877,395.78 562.066,295.39"/>
    </g>
</svg>
<a title="My personal website.
" href="/">Joel Strouts</a></div><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></div><nav class="navigation">
        <ul><li class="navigation__item"><a href="/archive.html">Archive</a></li><li class="navigation__item"><a href="/about.html">About</a></li><li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li></ul>
      </nav></div>
  </header>
</div><div class="page__content"><img class="article__header--cover" src="/images/mcdonalds-again.jpg"></img><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div></aside></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet --><article><div class="article__header"><header><h1>Creature of Habit</h1></header><span class="split-space">&nbsp;</span>
          <a class="edit-on-github"
            title="Edit on Github"
            href="https://github.com/joelstrouts/joelstrouts.github.io/tree/master/_posts/2019-07-20-In-McDonalds-Again.md">
            <i class="far fa-edit"></i></a></div><meta itemprop="headline" content="Creature of Habit"><div class="article__info clearfix"><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jul 20, 2019</span>
            </li></ul></div><meta itemprop="author" content="Joel Strouts"/><meta itemprop="datePublished" content="2019-07-20T00:00:00+01:00"><div class="js-article-content"><div class="layout--article"><!-- start custom article top snippet -->

<!-- end custom article top snippet --><div class="article__content" itemprop="articleBody"><p>A brief update. An important work milestone and a vignette of how I spend my wild late nights in this vibrant, restless city - working in McDonalds.</p>

<!--more-->

<h3 id="a-carafe-out-of-place">A Carafe out of place</h3>

<p>My plan read “<em>write next blog by saturday</em>”.</p>

<p>Well it’s 4AM on Sunday morning (which, yes does still count as Saturday) and I’m at the 24 hour McDonald’s by the uni, celebrating - because I am now ready to <strong>begin</strong> writing it.</p>

<p>Fight club, the film (although I hear the book is pretty good, maybe better), has been on my mind. Good film. Specifically, right at the start where we are being introduced to the character of Edward Norton, and he tells us about his perfect, modern apartment - his obsession with Ikea, the hand crafted bowls and identity-defining dining set - then it all gets blown up. It’s become a big reference for me. Ed’s condo gets blown to pieces and even though he loved it so, in the end he’s thankful. He thought that he had been making his life more and more perfect but, in the void after the fire, he realised this: Rather than improving his life, he had become the possession of his possessions. By curating a life so exact in its comforts, by assigning such importance to every detail - every coffee cup, coaster, carafe - he suffered from an acute interior-design-related anxiety. An anxiety that he alone was responsible for creating, but nevertheless held him captive. To be unable to buy a new toothbrush because the handle must be rosewood (so as to match the cabinet doors) - Or: to be incapable of sleeping at a friend’s because their bedsheets have not the sufficient thread count. That’s the prison Norton had constructed for himself. And I think the film makes quite a persuasive argument, in this way, that possessions are not all that good. Edward Norton’s case is extreme, but the message is clear, caring about this stuff is a bit silly, and really caring about it might drive you so mad that you get insomnia and, one day, find that your home has spontaneously combusted.</p>

<p>So Edward realises the error of his ways and begins beating up other men in pub basements. Hang on a minute, what was the moral of the story supposed to be again?</p>

<p>Anyway, the reason it’s been a big reference for me - this conflict between curated comfort, and the liberty of holding nothing dear - is because I am Edward Norton before his apartment blows up. I have made my life very comfortable, in my very particular ways. I am always making it <em>more</em> comfortable, and that suits me just fine most the time, until I remember that blazing fire, and Edward’s change of heart. Do I need a change of heart?</p>

<p>I’ve never been able to stick to a routine, but I sure have built up a nice collection of <em>routines</em>, and I like to carry them out just-so. Like here, now, at McDonald’s. I’ve only been in Hong Kong a little over two weeks (gee, that’s actually a while isn’t it?) but my order, the bubble tea and the 6 nuggets and fries, I think this is the fourth time I’ve got it. I will get it again, and in the exact same way. Same dips, same shaking spice. I will wear my favourite GAP hoodie (because the AC is a little too cold), I will put my phone in the inwards facing pocket of my Marimekko bum-bag. I will plug my chunky, curly corded headphones in and choose a playlist to listen to (or maybe just put my loves on shuffle). I know what does and does not go in every pocket. I could tell you now exactly what my pockets will contain a week from now. And when I finally get a stain on this jumper that won’t come out, or wear a hole in this bum bag, drop my phone, or God forbid, McDonald’s stops offering this promotion, I will find that really tough.</p>

<p>The one area of my life I am most guilty of this anxiety-inducing dogged pursuit of, well - I don’t know what it’s even a pursuit of really. Marginal gains? That area is digital, electronic. When I proudly showed my research supervisor one of the little hacks I had put together, <em>he</em> - post doctorate computer science researcher - called me a nerd. Perhaps efficiency hacks can be justified up to a point, but that seemed like an indication that perhaps the point is behind me.</p>

<p>I am willing to endure so much frustration in the name of reducing frustration. This week has been a frustration filled one, and now - at it’s end - I have reached the bit with the gains and it’s pretty nice, Check it out!</p>

<h3 id="the-big-reveal">The big reveal</h3>
<canvas id="my-canvas" height="700" width="600" hidden="true"></canvas>
<p><input id="my-button" type="button" value="click here to generate a fern!" /></p>

<script>
  let canvas = document.getElementById('my-canvas');
  let button = document.getElementById('my-button');
  button.onclick = () => {
    canvas.hidden = false;
    paint(canvas, IFS.get(barnsleyFern, 250000, {colors: [[255,0,0]]}));
  }
 </script>

<p>Assuming it worked, and there’s a box above this paragraph that a fern is drawn in when you press the submit button - I am pretty chuffed. The reason I’m questioning whether I’ve used my time well is because the ‘real’ work in producing that image was (to describe what I’ve done in the least favourable way) just me copying someone else’s code. What took the rest of the time, (or actually, most of the time) was in the presentation, and the behind the scenes stuff. The difference between getting it working and getting it working in the particular way that fits my workflow. But it’s done now and hopefully the fussing over details will make the work in the coming weeks go a little smoother.</p>

<h3 id="end">End</h3>

<p>And that’s where I’m going to leave it. A little thought about fight club, and a little research milestone.</p>
</div><section class="article__sharing d-print-none"></section><div class="d-print-none"><footer class="article__footer"><meta itemprop="dateModified" content="2019-07-20T00:00:00+01:00"><!-- start custom article footer snippet -->

<!-- end custom article footer snippet --><div class="article__subscribe"><div class="subscribe"><i class="fas fa-rss"></i> <a type="application/rss+xml" href="/feed.xml">Subscribe</a></div></div><div class="article__license"><div class="license">
    <p>This work is licensed under a <a itemprop="license" rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">Attribution-NonCommercial 4.0 International</a> license.
      <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">
        <img alt="Attribution-NonCommercial 4.0 International" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" />
      </a>
    </p>
  </div></div></footer><div class="article__section-navigator clearfix"><div class="previous"><span>PREVIOUS</span><a href="/2019/07/10/Working-in-Hong-Kong-Part-2.html">Research Plans</a></div><div class="next"><span>NEXT</span><a href="/2019/07/30/IFS.html">Interactive IFS Toy</a></div></div></div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script></div><section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet --></div>
            </div></div></div><div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joel Strouts"><meta itemprop="url" content="/"><meta itemprop="description" content="I'm working on it"><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div><a href="https://www.youtube.com/playlist?list=PLMpqzIjWEjCG2eHaEaeyBaKMJQdAq88uz">©</a> Joel Strouts 2019,
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> & <a
        title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
  
<!-- start custom footer snippets -->

  <script>console.log('no libraries included');</script>



    <script>console.log('included scripts were: IFS');</script>
    
    
    
      <script async="true" defer>
        // TODO: add functionality to write a properties on each last generation
// TODO: add functionality to save last random system of equations
// in placeholder IFS variable
// Thought about inverse problem:
// make training data for neural network by automatically generating
// vast numbers of random images and associating with each output
// image a battery of statistics about each combination of transforms.
// perhaps train several models one for each different aspect of
// the reverse engineering problem. Supply each with vector of values
// you think most relevant.
/**************************/
/* HELPER FUNCTIONS START */
/**************************/
/* FUNCTIONAL ESSENTIALS
 */
const zip = (list1, list2) => list1.map((value, key) => [value, list2[key]]);
const getComposition = (...functions) => (point) => {
  return functions.reduce((value, func) => func(value), point);
}
const override = (defaults, reconsiderations) => {
  let returnValues = {};
  if (!reconsiderations) {
    for (index in Object.keys(defaults)) {
      let key = Object.keys(defaults)[index];
      returnValues[key] = defaults[key];
    }
    return defaults;
  } else {
    for (index in Object.keys(defaults)) {
      let key = Object.keys(defaults)[index];
      returnValues[key] =  
        (reconsiderations[key]) ? reconsiderations[key] : defaults[key];
    }
    return returnValues;
  }
}

/* LINEAR ALGEBRA
 * (VECTOR RELATED)
 */
const vScale = (a, v) => v.map((entry) => a * entry);
const vAdd = (...vectors) => vectors.reduce((v,w) => [v[0] + w[0], v[1] + w[1]]);
const vMinus = (v, w) => vAdd(v, vScale(-1, w));
const vMod = v => Math.sqrt(v.reduce((e1, e2) => e1 * e1 + e2 * e2));
const dot = (v, w) => zip(v,w).reduce((pair1, pair2) => pair1[0] * pair1[1] + pair2[0] * pair2[1]);
const getTranslation = c => p => vAdd(p,c);
/* (MATRIX RELATED)
 */
const det = ([[a,c],[b,d]]) => a*d - b*c;
const mInverse = ([[a,c],[b,d]]) => mScale(1/(a*d - b*c), [[d,-c],[-b,a]]);
const mScale = (a, M) => M.map(v => vScale(a, v));
const mProduct = (...matricies) => matricies.reduce(
  (A, B) => [getLinear(A)(B[0]), getLinear(A)(B[1])]
);
const getAffine = (M,c) => p => getComposition(getLinear(M), getTranslation(c))(p);
const getLinear = M => p => {
  return [
    p[0] * M[0][0] + p[1] * M[1][0],
    p[0] * M[0][1] + p[1] * M[1][1]
  ];
}
const randomAffine = (rotation, uniform) => {
  let r = [0,0,0,0,0,0].map(() => Math.random() * 2 - 1);
  if (!rotation) { [r[1],r[2]] = [0,0]; }
  if (uniform) { r[3] = r[0]; }
  return getAffine([[r[0], r[1]], [r[2], r[3]]], [r[4], r[5]]);
}
const randomLinear = () => {
  let r = [0,0,0,0].map(() => Math.random() * 2 - 1);
  return getLinear([[r[0], r[1]], [r[2], r[3]]], [r[4], r[5]]);
}
const inferTranslation = affine => {
  return affine([0,0]);
}
const inferLinear = affine => {
  let v = inferTranslation(affine);
  return [vMinus(affine([1,0]), v), vMinus(affine([0,1]), v)]
}
const inferInverse = affine => {
  return getComposition(
    getTranslation(vScale(-1, inferTranslation(affine))),
    getLinear(mInverse(inferLinear(affine))),
  )
}
const getFixedPoint = affine => {
  let v = inferTranslation(affine);
  console.log('translation is '.concat(v));
  let phi = inferLinear(affine);
  console.log('linear part is '.concat(phi));
  let coefficients = mInverse([vMinus(phi[0], [1,0]), vMinus(phi[1], [0,1])]);
  return getLinear(coefficients)(vScale(-1, v))
}
/* DISCRETE MATHS
 */
const ipart = x => Math.floor(x);
const round = x => ipart(x + 0.5);
const fpart = x => x - Math.floor(x);
const rfpart = x => 1 - fpart(x);
const cummulative = list => {
  let returnList = [list[0]];
  let runningTotal = list[0];
  for (var i = 1; i < list.length; i++) {
    runningTotal += list[i];
    returnList = returnList.concat(runningTotal);
  }
  return returnList;
}

/* PROJECTION / DRAWING
 */
const getCoordinateTransform = (from, to) => (point) => {
  return getComposition(
    getTranslation(vScale(-1, from.o)),
    getLinear(mInverse([from.x, from.y])),
    getLinear([to.x, to.y]),
    getTranslation(to.o)
  )(point);
}
const scaleTransform = (f, amount) => p => {
  return getComposition(f, getLinear([[amount,0],[0,amount]]))(p)
}
const getOutputRegion = (referenceRegion, canvas, options) => {
  let outputRegion = { o: [0,0], x: [1,0], y: [0,1] };
  switch (options.position) {
    case 'centre':
      // input region is R, output region is S - given heights and widths.
      // f: R -> S
      let R = [vMod(referenceRegion.x), vMod(referenceRegion.y)],
          Rratio = R[1]/R[0];
          S = [],
          VP = [canvas.width, canvas.height],
          VPratio = VP[1]/VP[0];
          middle = vScale(1/2, VP);
      if (Rratio > VPratio) { // slack width
        S = [
          Math.floor((1 / Rratio) * VP[1] * options.scale), 
          Math.floor(VP[1] * options.scale)
        ];
      } else { // slack height
        S = [
          Math.floor(VP[0] * options.scale), 
          Math.floor(Rratio * VP[0] * options.scale)
        ];
      }
      outputRegion = { 
        o: [
          Math.floor(middle[0] - S[0]/2),
          Math.floor(middle[0] + S[1]/2),
        ],
        x: [ S[0], 0 ],
        y: [ 0, - S[1] ],
        }
      break;
  }
  return outputRegion;
}
const paintPixel = ([x,y], imgData, rgba) => {
  if  (x > 0 
    && x < imgData.width
    && y > 0
    && y < imgData.height) {
    const index = 4 * (y * imgData.width + x);
    imgData.data[index + 0] = rgba[0];
    imgData.data[index + 1] = rgba[1];
    imgData.data[index + 2] = rgba[2];
    imgData.data[index + 3] = rgba[3];
  }
}
const paintPixelBox = ([x,y], imgData, rgba, size) => {
  for (var i = - size; i < size; i++) {
    for (var j = - size; j < size; j++) {
      paintPixel([x + i, y + j], imgData, rgba);
    }
  }
}

const drawPoint = (point, imageData, style, rgba, options) => {
  switch (style) {
    case 'dots':
      paintPixel(point, imageData, rgba);
      break;
    case 'blobs':
      paintPixelBox(point, imageData, rgba, options);
      break;
  }
}
const drawLine = ([x1,y1], [x2,y2], imgData, rgb) => {
  let steep = Math.abs(y2 - y1) > Math.abs(x1 - x2);
  if (steep)   { [x1, y1] = [y1, x1]; [x2, y2] = [y2, x2]; }
  if (x1 > x2) { [x1, x2] = [x2, x1]; [y1, y2] = [y2, y1]; }
  let dx = x2 - x1;
  let dy = y2 - y1;
  let m = dy / dx;
  if (dx === 0) { m = 1 }
   
  // first end point
  let xend = round(x1);
  let yend = y1 + m * (xend - x1);
  let xgap = rfpart(x1 + 0.5)
  let xpxl1 = xend;
  let ypxl1 = ipart(yend);
  if (steep) {
    paintPixel([ypxl1, xpxl1],     imgData, rgb.concat(rfpart(yend) * xgap * 255));
    paintPixel([ypxl1 + 1, xpxl1], imgData, rgb.concat( fpart(yend) * xgap * 255));
  } else {
    paintPixel([xpxl1, ypxl1],     imgData, rgb.concat(rfpart(yend) * xgap * 255));
    paintPixel([xpxl1, ypxl1 + 1], imgData, rgb.concat( fpart(yend) * xgap * 255));
  }
  let intery = yend + m;

  // second end point
  xend = round(x2);
  yend = y2 + m * (xend - x2);
  xgap = fpart(x2 + 0.5)
  let xpxl2 = xend;
  let ypxl2 = ipart(yend);
  if (steep) {
    paintPixel([ypxl2, xpxl2],     imgData, rgb.concat(rfpart(yend) * xgap * 255));
    paintPixel([ypxl2 + 1, xpxl2], imgData, rgb.concat(fpart(yend) * xgap * 255));
  } else {
    paintPixel([xpxl2, ypxl2],     imgData, rgb.concat(rfpart(yend) * xgap * 255));
    paintPixel([xpxl2, ypxl2 + 1], imgData, rgb.concat( fpart(yend) * xgap * 255));
  }

  // line inbetween
  if (steep) {
    for (var x = xpxl1 + 1; x < xpxl2; x++) {
      paintPixel([ipart(intery), x],     imgData, rgb.concat(rfpart(intery) * 255));
      paintPixel([ipart(intery) + 1, x], imgData, rgb.concat( fpart(intery) * 255));
      intery = intery + m;
    }
  } else {
    for (var x = xpxl1 + 1; x < xpxl2; x++) {
      paintPixel([x, ipart(intery)],     imgData, rgb.concat(rfpart(intery) * 255));
      paintPixel([x, ipart(intery) + 1], imgData, rgb.concat( fpart(intery) * 255));
      intery = intery + m;
    }
  }
}
const drawPolygon = (verts, imgData, rgba) => {
  let rgb = rgba.slice(0,3);
  verts = verts.concat([verts[0]]);
  verts.reduce((a,b) => { drawLine(a,b,imgData,rgb); return b; });
  verts.map(p => { paintPixelBox(p, imgData, rgba, 3); return p});
}
const rgbToHex = (r, g, b) => '#' + [r, g, b].map(x => {
  const hex = x.toString(16)
  return hex.length === 1 ? '0' + hex : hex
}).join('')

/************************/
/* HELPER FUNCTIONS END */
/************************/

/************************/
/*    PRESETS           */
/************************/
const transformToLatex = (index, array, reColor) => {
  let linear = array[0].map(column => column.map(el => el.toFixed(5)));
  let translation = array[1].map(el => el.toFixed(5));
  let myColor = "#000000";
  if (reColor) {
    myColor = rgbToHex(...IFS.defaultOptions.colors[index+1]);
  }

  return `\\color{${myColor}}{f_{${index + 1}}(\\mathbf{x})}&=\\begin{bmatrix}${linear[0][0]} & ${linear[1][0]}\\\\${linear[0][1]} & ${linear[1][1]}\\end{bmatrix}\\mathbf{x} + \\begin{bmatrix}${translation[0]}\\\\${translation[1]}\\end{bmatrix}`;
}
const paint = (canvas, fractalGetter) => {
  IFS.canvas = canvas;
  canvas.getContext('2d').putImageData(fractalGetter(), 0, 0);
}
const IFS = {
  init: (def, options) => {
    if (def.init) { def.init(options); }
    def.ctf = getCoordinateTransform(
      def.referenceRegion, 
      getOutputRegion(def.referenceRegion, IFS.canvas, options)
    );
    // calculate probability bins
    if (def.probabilities === 'equal') {
      def.probabilities = Array(def.transforms.length).fill(1/def.transforms.length);
      def.probBins = cummulative(def.probabilities);
      def.probabilities = 'equal';
    } else if (def.probabilities === 'area-weighted') {
      let scales = def.transforms.map(f => {
        let e1 = vMinus(f([1,0]), f([0,0]));
        let e2 = vMinus(f([0,1]), f([0,0]));
        return e1[0] * e2[1] - e2[0] * e1[1];
      }).map(x => Math.abs(x) + 0.25 / def.transforms.length);
      let M = scales.reduce((a,b) => a + b);
      def.probabilities = scales.map(factor => factor / M);
      console.log(def.probabilities);
      def.probBins = cummulative(def.probabilities);
      def.probabilities = 'area-weighted';
    } else {
      def.probBins = cummulative(def.probabilities);
    }
    def.asPixel = p => def.ctf(p).map(e => Math.floor(e));
    IFS.setProperties(def);
    IFS.setReport(options);
  },
  get: (def, n, options) => () => {
    options = override(IFS.defaultOptions, options);
    IFS.init(def, options);
    IFS.lastOutput.push(getIFS(def, n, options));
    return IFS.lastOutput.slice(-1)[0];
  },
  applyTransform: def => p => {
    let rand = Math.random();
    let choice = 0;
    while (rand > def.probBins[choice]) { choice += 1; }
    IFS.lastTransform = choice;
    return def.transforms[choice](p);
  },
  lastOutput: [],
  defaultOptions: {
    runnable: false,
    style: 'dots',
    color: 'uniform',
    colors: [
      [0, 0, 0],
      [0, 200, 0],
      [190, 0, 150],
      [200, 110, 0],
      [210, 0, 0],
      [0, 0, 200],
      [0, 110, 200],
      [40, 40, 40],
    ],
    bboxes: false,
    blobsSize: 1,
    initialPoint: [0,0],
    position: 'centre',
    scale: 0.9,
    new: false,
  },
  setProperties: def => {
    IFS.properties = {};
    IFS.properties.transforms = def.transforms.map(affine => {
      return [inferLinear(affine), inferTranslation(affine)];
    })
    IFS.properties.fixedPoints = def.transforms.map(affine => getFixedPoint(affine));
  },
  setReport: options => {
    let color = (options.color == 'last') ? true : false;
    latexTransforms = IFS.properties.transforms.map((v,k) => transformToLatex(k, v, color));
    latexTransforms = latexTransforms.reduce((prev, current) => prev + "\\\\" + current);
    IFS.latex = "$$\\bbox[20px, border: 2px solid orange]{\\begin{align}" + latexTransforms + "\\end{align}}$$";
  },
}
const getIFS = (def, N, options) => {
  const imageData = new ImageData(IFS.canvas.width, IFS.canvas.height);
  let thisColor; if (options.color == 'last') {
    IFS.lastTransform = 0;
    thisColor = () => options.colors[IFS.lastTransform + 1];
  } else {
    thisColor = () => options.colors[0];
  }
  let p = options.initialPoint;
  if (options.bboxes) {
    let [a,b,c,d] = [
      def.referenceRegion.o,
      vAdd(def.referenceRegion.o, def.referenceRegion.x),
      vAdd(def.referenceRegion.o, def.referenceRegion.x, def.referenceRegion.y),
      vAdd(def.referenceRegion.o, def.referenceRegion.y)
    ];
    let [p,q,r,s] = [a,b,c,d].map(p => def.asPixel(p));
    drawPolygon([p,q,r,s], imageData, [0,0,0,255]);
    IFS.lastTransform = 0;
    def.transforms.map(f => {
      [p,q,r,s] = [a,b,c,d].map(p => def.asPixel(f(p)));
      drawPolygon([p,q,r,s], imageData, thisColor().concat(255));
      IFS.lastTransform += 1;  
    })
  }
  // MAIN LOOP
  console.log(options.style);
  for (var i = 0; i < N; i++) {
    let q = IFS.applyTransform(def)(p);
    let [a, b] = [p,q].map(v => def.ctf(v).map(e => Math.floor(e)));
    if (options.style == 'dots') {
      paintPixel(b, imageData, thisColor().concat(255));
    } else if (options.style == 'blobs') {
      paintPixelBox(b, imageData, thisColor().concat(255), options.blobsSize);
    } else if (options.style == 'lines') {
      drawLine(a, b, imageData, thisColor());
      paintPixelBox(b, imageData, thisColor().concat(255), options.blobsSize);
    }
    p = q;
  }
  if (options.style == 'blobs' || options.style == 'lines') {
    paintPixelBox(def.ctf(options.initialPoint).map(e => Math.floor(e)), imageData, [255,0,0,255], options.blobsSize);
  }
  if (options.fixedPoints) {
    IFS.lastTransform = 0;
    def.transforms.map(affine => {
      let fixedP = getFixedPoint(affine);
      console.log('fixed point is: '.concat(fixedP));
      paintPixelBox(def.asPixel(fixedP, imageData), imageData, thisColor().concat(255), 4);
      paintPixelBox(def.asPixel(fixedP, imageData), imageData, [255,0,0,255], 2);
      IFS.lastTransform += 1;  
    })
  }
  return imageData;
}

const barnsleyFern = {
  referenceRegion: {
    o: [-2.4,-0.5],
    x: [5.5 ,0 ] ,
    y: [0   ,11],
  },
  transforms: [
    getLinear([[ 0.00, 0.00],[ 0.00, 0.16]]),
    getAffine([[ 0.85,-0.04],[ 0.04, 0.85]], [0.00,1.60]),
    getAffine([[ 0.20, 0.23],[-0.26, 0.22]], [0.00,1.60]),
    getAffine([[-0.15, 0.26],[ 0.28, 0.24]], [0.00,0.44]),
  ],
  probabilities: [
    0.01,
    0.85,
    0.07,
    0.07,
  ],
};
const binaryTree = {
  referenceRegion: {
    o: [-0.5,0  ],
    x: [1   ,0  ] ,
    y: [0   ,0.9],
  },
  transforms: [
    getLinear([[ 0, 0.00],[ 0.00, 0.45]]),
    getAffine([[ 0.42, 0.42],[-0.42, 0.42]], [0.00, 0.40]),
    getAffine([[ 0.42,-0.42],[ 0.42, 0.42]], [0.00, 0.40]),
  ],
  probabilities: Array(3).fill(1/3),
};
const mapleLeaf = {
  referenceRegion: {
    o: [-3.5,-3.6],
    x: [7,0] ,
    y: [0,7.1],
  },
  transforms: [
    getComposition(getLinear([[0.5,0],[0,0.65]]), getTranslation([0,1.2])),
    getAffine([[ 0.45,-0.45],[ 0.45, 0.45]], [ 1.62,-0.65]),
    getAffine([[ 0.45, 0.45],[-0.45, 0.45]], [-1.62,-0.65]),
    getComposition(getLinear([[0,0],[0,-0.4]]), getTranslation([0,-2.3])),
  ],
  probabilities: [0.31,0.31,0.31,0.07]
};
const sandDollar = {
  referenceRegion: {
    o: [0,0],
    x: [1,0] ,
    y: [0,1],
  },
  transforms: [
    getAffine([[ 0.382, 0.0000],[ 0.0000, 0.382]], [0.3090, 0.5710]),
    getAffine([[ 0.118, 0.3630],[-0.3630, 0.118]], [0.3633, 0.3306]),
    getAffine([[ 0.118,-0.3630],[ 0.3630, 0.118]], [0.5187, 0.6940]),
    getAffine([[-0.309, 0.2245],[-0.2245,-0.309]], [0.6070, 0.3090]),
    getAffine([[-0.309,-0.2245],[ 0.2245,-0.309]], [0.7016, 0.5335]),
    getAffine([[ 0.382, 0.0000],[ 0.0000,-0.382]], [0.3090, 0.6770]),
  ],
  probabilities: 'equal',
};
const serpinski = {
  referenceRegion: {
    o: [0,0],
    x: [2,0],
    y: [0,2],
  },
  transforms: [
    getLinear([[1/2, 0],[0,1/2]]),
    getAffine([[1/2, 0],[0,1/2]], [1, 0]),
    getAffine([[1/2, 0],[0,1/2]], [0, 1]),
  ],
  probabilities: Array(3).fill(1/3),
};
const random = {
  scale: 0.7,
  order: 4,
  rotation: true,
  uniform: false,
  referenceRegion: {
    o: [-0.5,-0.5],
    x: [1   ,0] ,
    y: [0   ,1],
  },
  transforms: [], // defined on object initialization
  probabilities: 'area-weighted', 
  init: options => {
    if (options.new == true || random.transforms.length < 1) {
      random.transforms = [];
      for (var i = 0; i < random.order; i++) {
        random.transforms = random.transforms.concat(scaleTransform(randomAffine(random.rotation, random.uniform), random.scale))
      }
    }
  },
};

      </script>
    

<script>console.log('custom footer processed');</script>
<!-- end custom footer snippets -->

</footer>
</div></div>
    </div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"><script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text" />
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  ⬅, 38  ⬆, 39  ➡, 40  ⬇
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script></div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script><script>
  window.Lazyload.js(['https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js', 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js'], function() {
    var $canvas = null, $this = null, _ctx = null, _text = '';
    $('.language-chart').each(function(){
      $this = $(this);
      $canvas = $('<canvas></canvas>');
      _text = $this.text();
      $this.text('').append($canvas);
      _ctx = $canvas.get(0).getContext('2d');
      (_ctx && _text) && (new Chart(_ctx, JSON.parse(_text)) && $this.attr('data-processed', true));
    });
  });
</script><script type="text/x-mathjax-config">
	var _config = { tex2jax: {
		inlineMath: [['$','$'], ['\\(','\\)']]
	}};MathJax.Hub.Config(_config);
</script>
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script>
  window.Lazyload.js('https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js', function() {
    mermaid.initialize({
      startOnLoad: true
    });
    mermaid.init(undefined, '.language-mermaid');
  });
</script>
    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>